!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var i in a)("object"==typeof exports?exports:e)[i]=a[i]}}(self,()=>(()=>{var e={33:()=>{AFRAME.registerComponent("teleport-portal",{schema:{targetPosition:{type:"string",default:"0 0 0"},triggerDistance:{type:"number",default:2},portalType:{type:"string",default:"entrance"},debug:{type:"boolean",default:!1}},init:function(){this.rig=null,this.playerPosition=new THREE.Vector3,this.portalPosition=new THREE.Vector3,this.targetPos=new THREE.Vector3;const e=this.data.targetPosition.trim().split(/\s+/);e.length>=3&&this.targetPos.set(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])),this.isTeleporting=!1,this.cooldownTime=1e3,this.lastTeleportTime=0,this.data.debug&&console.log("[TeleportPortal] Initialized:",{targetPosition:this.targetPos,triggerDistance:this.data.triggerDistance,portalType:this.data.portalType}),this.createTriangleIndicator()},createTriangleIndicator:function(){const e=document.createElement("a-entity");e.setAttribute("position","0 0.8 0"),e.setAttribute("visible","true");const t=new THREE.Mesh((()=>{const e=new THREE.Shape;return e.moveTo(0,.6),e.lineTo(-.6,-.6),e.lineTo(.6,-.6),e.lineTo(0,.6),new THREE.ShapeGeometry(e)})(),new THREE.MeshStandardMaterial({color:"#FFD700",emissive:"#FFD700",emissiveIntensity:1,side:THREE.DoubleSide,transparent:!1})),a=document.createElement("a-entity");a.setObject3D("mesh",t),a.setAttribute("rotation","0 0 180"),a.setAttribute("visible","true"),e.setAttribute("animation__float",{property:"position",to:"0 1.2 0",from:"0 0.8 0",dur:2e3,loop:"true",easing:"easeInOutSine",dir:"alternate"}),e.appendChild(a),this.triangleIndicator=e,this.el.appendChild(e),setTimeout(()=>{e.setAttribute("visible","true"),a.setAttribute("visible","true")},100)},tick:function(){const e=Date.now();if(e-this.lastTeleportTime<this.cooldownTime)return;if(!this.rig&&(this.rig=document.getElementById("rig"),!this.rig))return;if(this.isTeleporting)return;if(!this.rig.object3D||!this.el.object3D)return;try{this.rig.object3D.getWorldPosition(this.playerPosition),this.el.object3D.getWorldPosition(this.portalPosition)}catch(e){return void(this.data.debug&&console.warn("[TeleportPortal] Error getting positions:",e))}const t=this.playerPosition.x-this.portalPosition.x,a=this.playerPosition.z-this.portalPosition.z,i=Math.sqrt(t*t+a*a),n=this.playerPosition.distanceTo(this.portalPosition),o=i<=this.data.triggerDistance;this.data.debug&&Math.floor(e/1e3)%2==0&&console.log("[TeleportPortal]",{horizontalDistance:i.toFixed(2),fullDistance:n.toFixed(2),triggerDistance:this.data.triggerDistance,portalType:this.data.portalType}),o&&this.teleport()},teleport:function(){if(this.isTeleporting)return;this.isTeleporting=!0,this.lastTeleportTime=Date.now();const e=this.rig.getAttribute("position"),t="string"==typeof e?this.parsePosition(e):e||{x:0,y:0,z:0};this.data.debug&&console.log("[TeleportPortal] Teleporting player:",{from:t,to:this.targetPos,portalType:this.data.portalType});const a=(this.data.portalType,0),i={x:this.targetPos.x,y:this.targetPos.y+a,z:this.targetPos.z};this.createFadeEffect(i)},createFadeEffect:function(e){const t=this.rig.getAttribute("position"),a="string"==typeof t?this.parsePosition(t):t||{x:0,y:0,z:0};let i=document.getElementById("teleport-fade-overlay");i||(i=document.createElement("div"),i.id="teleport-fade-overlay",i.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: black;\n        z-index: 999999;\n        opacity: 0;\n        pointer-events: none;\n        transition: opacity 0.3s ease;\n      ",document.body.appendChild(i)),i.style.opacity="0",i.style.display="block",setTimeout(()=>{i.style.transition="opacity 0.3s ease",i.style.opacity="1",setTimeout(()=>{this.rig.setAttribute("position",{x:e.x,y:e.y,z:e.z}),this.rig.object3D.position.set(e.x,e.y,e.z);const t=this.rig.components["ground-constraint"];t&&t.setupGroundEntities&&t.setupGroundEntities(),this.rig.components["simple-navmesh-constraint"]&&this.rig.setAttribute("simple-navmesh-constraint",this.rig.getAttribute("simple-navmesh-constraint")),setTimeout(()=>{const t=this.rig.getAttribute("position");("string"==typeof t?parseFloat(t.split(/\s+/)[1]):t?.y||e.y)<e.y-.3&&(this.rig.setAttribute("position",{x:e.x,y:e.y,z:e.z}),this.rig.object3D.position.set(e.x,e.y,e.z),this.data.debug&&console.log("[TeleportPortal] âš ï¸ Corrected player position (prevented fall)"))},100);const n=new CustomEvent("portal-teleport",{detail:{portalType:this.data.portalType,from:a,to:e}});document.dispatchEvent(n),this.data.debug&&console.log("[TeleportPortal] âœ… Teleport completed to:",e),setTimeout(()=>{i.style.transition="opacity 0.3s ease",i.style.opacity="0",setTimeout(()=>{const t=this.rig.getAttribute("position"),a="string"==typeof t?parseFloat(t.split(/\s+/)[1]):t?.y||e.y;Math.abs(a-e.y)>.5&&(this.rig.setAttribute("position",{x:e.x,y:e.y,z:e.z}),this.rig.object3D.position.set(e.x,e.y,e.z),this.data.debug&&console.log("[TeleportPortal] âš ï¸ Corrected player position after teleport")),this.isTeleporting=!1,i.style.display="none"},300)},100)},300)},10)},parsePosition:function(e){if("string"!=typeof e)return{x:0,y:0,z:0};const t=e.trim().split(/\s+/);return{x:parseFloat(t[0])||0,y:parseFloat(t[1])||0,z:parseFloat(t[2])||0}},remove:function(){this.rig=null}})},134:()=>{const e=[["SittingIdle","/SittingIdle_man.fbx",{ignoreBones:["Spine1","Spine2","Neck","Head","LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.1}],["Idle","/BreathingIdle.fbx",{ignoreBones:["Spine1","Spine2","Neck","Head","LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.1}],["Walking","/Walking.fbx",{ignoreBones:["LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.1,removeHipsForwardAnimation:!0}],["Dying","/Dying.fbx",{ignoreBones:["LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:0}]],t=[["SittingIdle","/SittingIdle_woman.fbx",{ignoreBones:["Spine1","Spine2","Neck","Head","LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.1}],["Idle","/BreathingIdle.fbx",{ignoreBones:["Spine1","Spine2","Neck","Head","LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.168}],["Walking","/Walking.fbx",{ignoreBones:["LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:-.168,removeHipsForwardAnimation:!0}],["Dying","/Dying.fbx",{ignoreBones:["LeftEye","LeftEye_end","LeftEye_end_end","RightEye","RightEye_end","RightEye_end_end"],positionMultiplier:.01,positionOffset:0}]],a={};NAF.schemas.getComponentsOriginal=NAF.schemas.getComponents,NAF.schemas.getComponents=e=>(NAF.schemas.hasTemplate("#avatar-template")||NAF.schemas.add({template:"#avatar-template",components:["avatar-bones","player-info",{component:"position",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.001)},{component:"rotation",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.5)},{selector:".model",component:"rotation",requiresNetworkUpdate:NAF.utils.vectorRequiresUpdate(.5)}]}),NAF.schemas.getComponentsOriginal(e));const i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),n=e=>Math.round(100*e)/100;function o(e,t){for(let a=0,i=function(e){return Array.isArray(e)?e:e.bones}(t);a<i.length;a++)if(e===i[a].name)return i[a]}function s(e,t,a={}){const i=a.names??{},n=a.offsets??{},s=a.positionMultiplier??1,r=a.inverseBones??!1,l=a.ignoreBones??[],d=a.removeHipsForwardAnimation??!1,u=a.positionOffset??0,c=[],m=new THREE.Quaternion;return t.tracks.forEach(h=>{const g=h.name.split("."),p=g[0],y=i[p]||p,f=g[1];if(o(y,e.skeleton)||"Armature"===y)if(l.indexOf(y)>-1)console.log(t.name,"ignore track",y);else if(h instanceof THREE.VectorKeyframeTrack&&h.name.endsWith("position")&&a.hip===y){const e=new THREE.VectorKeyframeTrack(`${y}.${f}`,h.times,h.values.map((e,t)=>(e*=s,d&&t%3==1&&(e=0),0!==u&&t%3==2&&(e+=u),e)));c.push(e)}else if(h instanceof THREE.QuaternionKeyframeTrack){const e=h.times,t=h.values.map((e,t)=>r&&t%2==0?-e:e),a=n[y];if(a){const e=h.values.length/4;for(let i=0;i<e;++i)m.fromArray(t,4*i),m.multiply(a),m.toArray(t,4*i)}const i=new THREE.QuaternionKeyframeTrack(`${y}.${f}`,e,t);c.push(i)}}),new THREE.AnimationClip(t.name,t.duration,c)}AFRAME.registerComponent("avatar-bones",{schema:{Head:{type:"vec4"}},init:function(){"rig"!==this.el.id&&(this.headBuffer=new NAF.InterpolationBuffer(0,.1)),this.localEuler=new THREE.Euler,this.localQuaternion=new THREE.Quaternion,this.localQuaternion2=new THREE.Quaternion,this.localQuaternion3=new THREE.Quaternion,this.tmpQuaternion=new THREE.Quaternion,this.transitionQuaternionStart=new THREE.Quaternion,this.transitionQuaternionEnd=new THREE.Quaternion,this.prevTime=0,this.transitionProgress=1},events:{"model-loaded":function(){queueMicrotask(()=>{if(this.mesh=this.el.components["player-info"].mesh,this.mesh){const e=this.mesh.skeleton.bones;this.hips=o("Hips",e),this.spine=o("Spine",e),this.spine1=o("Spine1",e),this.spine2=o("Spine2",e),this.neck=o("Neck",e),this.head=o("Head",e),this.spine1quaternion=(new THREE.Quaternion).copy(this.spine1.quaternion),this.spine2quaternion=(new THREE.Quaternion).copy(this.spine2.quaternion),this.neckquaternion=(new THREE.Quaternion).copy(this.neck.quaternion)}})}},update:function(e){"rig"===this.el.id||this.headBuffer.setQuaternion(this.data.Head)},tick:function(e,t){if("rig"===this.el.id){if(this.head){if(!this.cameraEl&&(this.cameraEl=this.el.querySelector(".camera"),!this.cameraEl))return void console.log("No .camera found on rig children");const a=this.cameraEl.object3D,o=this.el.components["player-info"].avatarEl.object3D.quaternion,s=this.localQuaternion.copy(a.quaternion).multiply(i),r=this.localEuler.setFromQuaternion(s,"YXZ");r.x=0,r.z=0;const l=this.localQuaternion2.setFromEuler(r);if((o.angleTo(l)>.5||e-this.prevTime>2e3)&&(this.transitionProgress=0,this.transitionQuaternionStart.copy(o),this.transitionQuaternionEnd.copy(l),this.prevTime=e),this.transitionProgress<1&&(this.transitionProgress+=.006*t,o.slerpQuaternions(this.transitionQuaternionStart,this.transitionQuaternionEnd,this.transitionProgress)),"Idle"!==this.el.components["player-info"].data.state)return;this.spine1.quaternion.copy(this.spine1quaternion),this.spine2.quaternion.copy(this.spine2quaternion),this.neck.quaternion.copy(this.neckquaternion),this.head.quaternion.copy(s).premultiply(this.localQuaternion3.copy(o).invert());const d=this.head.rotation.z;this.head.rotation.z=-this.head.rotation.x,this.head.rotation.x=d,this.head.rotation.y-=.3,this.head.rotation.z=Math.max(-1,Math.min(.7,this.head.rotation.z)),this.head.rotation.x=Math.max(-1,Math.min(1,this.head.rotation.x)),this.data.Head.x=n(this.head.quaternion.x),this.data.Head.y=n(this.head.quaternion.y),this.data.Head.z=n(this.head.quaternion.z),this.data.Head.w=n(this.head.quaternion.w)}}else{if("Idle"!==this.el.components["player-info"].data.state)return;this.spine1&&this.spine1.quaternion.copy(this.spine1quaternion),this.spine2&&this.spine2.quaternion.copy(this.spine2quaternion),this.neck&&this.neck.quaternion.copy(this.neckquaternion),this.headBuffer.update(t),this.head&&this.head.quaternion.copy(this.headBuffer.getQuaternion())}}}),AFRAME.registerComponent("player-info",{dependencies:["avatar-bones"],schema:{name:{type:"string",default:"anonymous"},color:{type:"color",default:"#ffffff"},avatarSrc:{type:"string",default:""},state:{type:"string",default:"Idle"},muted:{type:"boolean",default:!1},avatarPose:{type:"string",default:"stand",oneOf:["stand","sit"]},seatRotation:{type:"number",default:0},squadId:{type:"string",default:""}},init:function(){this.nametag=this.el.querySelector(".nametag"),this.setAnimation=this.setAnimation.bind(this),this.setAnimationFromState=this.setAnimationFromState.bind(this),this.getAnimationMixer=this.getAnimationMixer.bind(this),this.removeAnimationMixer=this.removeAnimationMixer.bind(this),this.positionChanged=this.positionChanged.bind(this),this.isAtCloseDistance=this.isAtCloseDistance.bind(this),this.maxDistanceSquared=.25,this.rig=document.querySelector("#rig"),this.fbxLoader=new THREE.FBXLoader,this.glbLoader=new THREE.GLTFLoader,this.updatedEventDetail={el:void 0,data:void 0,oldData:void 0},this.boundSquadListener=this.applyNametagVisibility.bind(this),"undefined"!=typeof window&&window.addEventListener("nusa:squad-context-changed",this.boundSquadListener)},update:function(e){this.updatedEventDetail.data=this.data,this.updatedEventDetail.oldData=e,this.updatedEventDetail.el=this.el,this.el.sceneEl.emit("player-info-updated",this.updatedEventDetail),this.updatedEventDetail.data=void 0,this.updatedEventDetail.oldData=void 0,this.updatedEventDetail.el=void 0,this.nametag||(this.nametag=this.el.querySelector(".nametag")),this.nametag&&this.data.name&&this.nametag.setAttribute("value",this.data.name),this.applyNametagVisibility(),this.avatarEl=this.el.querySelector(".model"),this.avatarEl||(this.avatarEl=document.createElement("a-entity"),this.el.appendChild(this.avatarEl),this.avatarEl.setAttribute("class","model")),this.avatarEl.setAttribute("shadow",""),this.el.object3D.rotation.order="YXZ",this.avatarEl.object3D.rotation.order="YXZ",e&&this.data.avatarSrc&&e.avatarSrc&&this.data.avatarSrc!==e.avatarSrc&&(this.mesh=void 0,this.removeAnimationMixer()),this.data.avatarSrc&&this.avatarEl.setAttribute("gltf-model",this.data.avatarSrc),this.mesh&&this.mixer&&e&&this.data&&(e.state!==this.data.state||e.avatarPose!==this.data.avatarPose)&&this.setAnimationFromState()},applyNametagVisibility:function(){if(this.nametag||(this.nametag=this.el.querySelector(".nametag")),!this.nametag)return;const e="undefined"!=typeof window?window.__activeSquadId??null:null,t=this.data.squadId||null,a="rig"===this.el.id||!e||!t||e===t;this.nametag.setAttribute("visible",a)},remove:function(){"undefined"!=typeof window&&this.boundSquadListener&&window.removeEventListener("nusa:squad-context-changed",this.boundSquadListener)},tick:function(e){if("rig"!==this.el.id&&(this.el.object3D.visible=!this.isAtCloseDistance(this.rig.object3D,this.el.object3D)),this.mesh){const t=this.mesh.morphTargetDictionary;e%6e3<500&&(this.startBlinking=!0);const a=(Math.sin(e/100)+1)/2;a<.3&&(this.startBlinking=!1,this.mesh.morphTargetInfluences[t["h_expressions.ReyeClose_h"]]=0,this.mesh.morphTargetInfluences[t["h_expressions.LeyeClose_h"]]=0),this.startBlinking&&(this.mesh.morphTargetInfluences[t["h_expressions.ReyeClose_h"]]=a,this.mesh.morphTargetInfluences[t["h_expressions.LeyeClose_h"]]=a)}},setAnimation:function(e){this.avatarEl.setAttribute("animation-mixer",e)},setAnimationFromState(){let e=this.data.state;"Idle"===this.data.state&&(e="sit"===this.data.avatarPose?"SittingIdle":"Idle"),this.setAnimation(`clip:${e};loop:repeat`)},getAnimationMixer:function(){return this.avatarEl.getAttribute("animation-mixer")},removeAnimationMixer:function(){this.avatarEl.removeAttribute("animation-mixer"),this.mixer=null},positionChanged(){this.el.sceneEl.systems.waypoint?.occupyWaypoint&&this.el.sceneEl.systems.waypoint.unoccupyWaypoint(),this.mixer&&(clearTimeout(this.revertToIdleTimeout),this.revertToIdleTimeout=setTimeout(()=>{this.el.setAttribute("player-info","state","Idle")},100),this.el.setAttribute("player-info","state","Walking"))},isAtCloseDistance:function(e,t){const a=e.position,i=t.position,n=a.x-i.x,o=a.z-i.z;return n*n+o*o<this.maxDistanceSquared},events:{teleported:function(e){this.positionChanged()},moved:function(e){this.positionChanged()},"navigation-start":function(e){this.el.sceneEl.systems.waypoint?.occupyWaypoint&&this.el.sceneEl.systems.waypoint.unoccupyWaypoint(),this.el.hasAttribute("simple-navmesh-constraint")&&this.el.setAttribute("simple-navmesh-constraint","enabled",!1),this.el.setAttribute("player-info","state","Walking")},"navigation-end":function(e){this.el.hasAttribute("simple-navmesh-constraint")&&this.el.setAttribute("simple-navmesh-constraint","enabled",!0),this.el.setAttribute("player-info","state","Idle")},"model-loaded":function(i){this.nametag||(this.nametag=this.el.querySelector(".nametag")),this.nametag&&this.data.name&&this.nametag.setAttribute("value",this.data.name),"rig"===this.el.id&&this.avatarEl.object3D.traverse(e=>{e.layers&&(e.layers.disableAll(),e.layers.enable(3))}),this.avatarEl.object3D.traverse(e=>{e.isMesh&&(e.frustumCulled=!1)});const n=i.detail.model;if(n.name="Armature",this.mesh=n.getObjectByName("H_DDS_HighRes"),!this.mesh)return;queueMicrotask(()=>{setTimeout(()=>{const e=new THREE.Box3;e.setFromObject(n);const t=e.min.y;if(t>.25){const e=this.avatarEl.getAttribute("position")||{x:0,y:0,z:0},a=t-.1,i=.6*a,n=e.y-i;this.avatarEl.setAttribute("position",{x:e.x,y:n,z:e.z}),console.log("[PlayerInfo] Adjusted avatar down - minY:",t,"Excess:",a,"Adjustment:",i,"New Y:",n)}else if(t<-.05){const e=this.avatarEl.getAttribute("position")||{x:0,y:0,z:0},a=.1-t,i=e.y+a;this.avatarEl.setAttribute("position",{x:e.x,y:i,z:e.z}),console.log("[PlayerInfo] Adjusted avatar up (was too low/sinking) - minY:",t,"Adjustment:",a,"New Y:",i)}else console.log("[PlayerInfo] Avatar position OK, no adjustment needed - minY:",t)},300)});const o=()=>{n.animations=Array.from(a[l].animations),this.setAnimationFromState(),this.mixer=this.getAnimationMixer()},r=this.data.avatarSrc.indexOf("_F_")>-1,l=`valid-${r}`;if(a[l]=a[l]||{},a[l].animations)o();else{if(!a[l].promise){const i=new Promise((i,n)=>{(async()=>{const n=r?t:e,o=[];for(let[e,t,a]of n){const i=t.indexOf(".glb")>-1?this.glbLoader:this.fbxLoader;a=a??{};const n=(await i.loadAsync(t)).animations[0];let r=n;n.name=e,r=s(this.mesh,n,{hip:"Hips",names:{Reference:"Armature"},offsets:a.quatOffsets??{},positionMultiplier:a.positionMultiplier??1,positionOffset:a.positionOffset??0,ignoreBones:a.ignoreBones??[],removeHipsForwardAnimation:a.removeHipsForwardAnimation??!1}),console.log("retargeted",n.name,"renamed to",e),o.push(r),console.log("animation after conversion",r)}a[l].animations=o,i()})()});a[l].promise=i}a[l].promise.then(o).catch(()=>{console.error("Error loading the animations")})}}}})},226:()=>{AFRAME.registerComponent("ondel-npc",{schema:{speed:{type:"number",default:1},direction:{type:"string",default:"forward"},startPosition:{type:"vec3",default:{x:0,y:0,z:0}},corridorLength:{type:"number",default:120},pauseTime:{type:"number",default:2e3},animationSpeed:{type:"number",default:1}},init:function(){let e;if(console.log("[Ondel-NPC] Initializing ondel-ondel NPC..."),console.log("[Ondel-NPC] Component data:",this.data),"string"==typeof this.data.startPosition){const t=this.data.startPosition.trim().split(/\s+/);e={x:parseFloat(t[0])||0,y:parseFloat(t[1])||0,z:parseFloat(t[2])||0}}else if(this.data.startPosition&&"object"==typeof this.data.startPosition)e={x:this.data.startPosition.x||0,y:this.data.startPosition.y||0,z:this.data.startPosition.z||0};else{const t=this.el.getAttribute("position");e=t&&"object"==typeof t?{x:t.x||0,y:t.y||0,z:t.z||0}:{x:0,y:0,z:0}}this.currentPosition={x:e.x,y:e.y,z:e.z},this.startX=this.currentPosition.x,this.endXForward=this.startX+this.data.corridorLength/2,this.endXBackward=this.startX-this.data.corridorLength/2,this.isMoving=!0,this.isPaused=!1,this.pauseStartTime=0,this.animationFrame=0,this.lastPlayerDistance=1/0,this.experienceActive=!1,this.el.setAttribute("position",this.currentPosition),this.updateRotation(),this.el.addEventListener("model-loaded",()=>{console.log("[Ondel-NPC] Model loaded, setting up features..."),this.setupAnimation(),this.setupCollision(),this.setupVisualEffects()}),setTimeout(()=>{this.el.getObject3D("mesh")&&(console.log("[Ondel-NPC] Model already loaded, setting up features..."),this.setupAnimation(),this.setupCollision(),this.setupVisualEffects())},100),console.log("[Ondel-NPC] âœ… Ondel-ondel initialized:",{id:this.el.id||"unknown",position:this.currentPosition,direction:this.data.direction,startX:this.startX,endXForward:this.endXForward,endXBackward:this.endXBackward,corridorLength:this.data.corridorLength,speed:this.data.speed,isMoving:this.isMoving}),setTimeout(()=>{this.isMoving=!0,console.log(`[Ondel-NPC] âœ… Movement started for ${this.el.id||"ondel"}`)},500)},setupAnimation:function(){const e=this.el.getObject3D("mesh");if(e&&e.animations&&e.animations.length>0){console.log("[Ondel-NPC] Found animations:",e.animations.length);const t=e.animations.find(e=>e.name.toLowerCase().includes("walk")||e.name.toLowerCase().includes("move")||e.name.toLowerCase().includes("idle"));t&&(console.log("[Ondel-NPC] Playing animation:",t.name),this.el.setAttribute("animation-mixer",{clip:t.name,loop:"repeat",repetitions:1/0,timeScale:this.data.animationSpeed}))}},tick:function(e,t){if(!0===window.__isConvertPage)this.experienceActive=!0;else if(this.experienceActive=this.isExperienceActive(),!this.experienceActive){const e=document.querySelector("a-scene");if(!e||!e.hasLoaded)return;this.experienceActive=!0}if(this.isPaused)return void(performance.now()-this.pauseStartTime>=this.data.pauseTime&&(this.isPaused=!1,console.log(`[Ondel-NPC] Pause ended, continuing movement in ${this.data.direction} direction`)));if(!this.isMoving)return;const a=this.getPlayerDistance()<10;let i=this.data.speed;a&&(i*=.5);const n=i*t/1e3;if("forward"===this.data.direction){if(this.currentPosition.x+=n,this.currentPosition.x>=this.endXForward)return this.currentPosition.x=this.endXForward,void this.startPause()}else if(this.currentPosition.x-=n,this.currentPosition.x<=this.endXBackward)return this.currentPosition.x=this.endXBackward,void this.startPause();this.animationFrame+=.003*t;const o=.05*Math.sin(this.animationFrame);this.el.setAttribute("position",{x:this.currentPosition.x,y:this.currentPosition.y+o,z:this.currentPosition.z}),this.updateRotation(),Math.floor(e/1e4)!==Math.floor((e-t)/1e4)&&console.log(`[Ondel-NPC] Moving ${this.data.direction} at position: ${this.currentPosition.x.toFixed(1)}`)},updateRotation:function(){const e=this.el.getAttribute("rotation")||{x:0,y:0,z:0};let t;e.y,t="forward"===this.data.direction?90:-90,this.el.setAttribute("rotation",{x:e.x||0,y:t,z:e.z||0})},startPause:function(){this.isPaused=!0,this.pauseStartTime=performance.now(),this.data.direction="forward"===this.data.direction?"backward":"forward",this.updateRotation(),console.log(`[Ondel-NPC] Reached end, pausing for ${this.data.pauseTime}ms. New direction: ${this.data.direction}, position: ${this.currentPosition.x.toFixed(2)}`)},changeDirection:function(){this.data.direction="forward"===this.data.direction?"backward":"forward",console.log(`[Ondel-NPC] Direction changed to: ${this.data.direction}`)},toggleMovement:function(){this.isMoving=!this.isMoving,console.log("[Ondel-NPC] Movement "+(this.isMoving?"resumed":"paused"))},setupCollision:function(){},setupVisualEffects:function(){},tempPauseMovement:function(){const e=this.data.speed;this.data.speed=.3*e,setTimeout(()=>{this.data.speed=e},2e3)},getPlayerDistance:function(){const e=document.getElementById("rig");if(!e)return 1/0;const t=e.getAttribute("position"),a=this.el.getAttribute("position");if(!t||!a)return 1/0;const i=t.x-a.x,n=t.z-a.z;return Math.sqrt(i*i+n*n)},isExperienceActive:function(){if("undefined"==typeof window)return!1;if("function"==typeof window.experienceStarted)try{return Boolean(window.experienceStarted())}catch(e){return console.warn("[Ondel-NPC] Unable to read experience status:",e),!1}return!1}}),console.log("[Ondel-NPC] Component registered successfully")},295:()=>{AFRAME.registerComponent("ground-constraint",{schema:{groundDistance:{type:"number",default:1.6},groundOffset:{type:"number",default:0},updateInterval:{type:"number",default:100}},init:function(){this.raycaster=new THREE.Raycaster,this.groundEntities=null,this.lastUpdate=0,this.el.sceneEl.addEventListener("loaded",()=>{this.setupGroundEntities()}),this.el.sceneEl.hasLoaded&&this.setupGroundEntities()},setupGroundEntities:function(){this.groundEntities=this.el.sceneEl.querySelectorAll(".environmentGround, .environmentDressing"),console.log("[GroundConstraint] Found ground entities:",this.groundEntities.length),0===this.groundEntities.length&&setTimeout(()=>{this.groundEntities=this.el.sceneEl.querySelectorAll(".environmentGround, .environmentDressing"),console.log("[GroundConstraint] Retry - Found ground entities:",this.groundEntities.length)},1e3)},tick:function(e,t){if(e-this.lastUpdate<this.data.updateInterval)return;if(this.lastUpdate=e,!this.groundEntities||0===this.groundEntities.length)return;const a=this.el,i=a.object3D.position,n=i.y+1,o=new THREE.Vector3(i.x,n,i.z),s=new THREE.Vector3(0,-1,0);this.raycaster.set(o,s),this.raycaster.far=10;let r=1/0,l=null;if(this.groundEntities.forEach(e=>{if(e.object3D&&!1!==e.object3D.visible)try{this.raycaster.intersectObject(e.object3D,!0).forEach(e=>{const t=o.y-e.distance;e.distance<r&&t<i.y&&t>i.y-5&&(r=e.distance,l=t+this.data.groundDistance+this.data.groundOffset)})}catch(e){}}),null!==l&&Math.abs(i.y-l)>.1){const e=l,t=i.y,n=Math.abs(t-e);if(e>t+.5)return;if(e>t&&n>.5)return;let o;if(n>1&&e<t)o=e,console.log("[GroundConstraint] Player floating detected, snapping to ground:",t,"->",o);else{if(!(e<t))return;o=t+.5*(e-t)}a.object3D.position.y=o,n>.5&&console.log("[GroundConstraint] Fixed player Y position:",t,"->",o)}}}),console.log("[GroundConstraint] Component registered")},430:()=>{AFRAME.registerComponent("car-pusher",{schema:{pushStrength:{default:5},radius:{default:1.5}},init:function(){this.playerPos=new THREE.Vector3,this.carPos=new THREE.Vector3,this.pushVector=new THREE.Vector3,this.carBody=null,this.physicsSystem=this.el.sceneEl.systems.physics},tick:function(e,t){if(!this.carBody){if(!this.physicsSystem)return;if(this.carBody=this.physicsSystem.getBodyById("ferrariBody"),!this.carBody)return}this.el.object3D.getWorldPosition(this.playerPos),this.carBody.el.object3D.getWorldPosition(this.carPos);const a=this.playerPos.distanceTo(this.carPos);if(a<this.data.radius){const e=this.data.radius-a;if(e<=0)return;this.pushVector.subVectors(this.carPos,this.playerPos).normalize();const t=e*this.data.pushStrength;this.carBody.velocity.set(this.pushVector.x*t,0,this.pushVector.z*t)}}})},585:()=>{AFRAME.registerComponent("follow-entity",{schema:{target:{type:"selector"}},tick:function(){if(!this.data.target)return;const e=this.data.target.object3D.position,t=this.data.target.object3D.quaternion;this.el.object3D.position.copy(e),this.el.object3D.quaternion.copy(t)}})},710:()=>{let e,t=!1;AFRAME.registerComponent("change-room",{schema:{on:{type:"string",default:"click"},room:{type:"string",default:""},url:{type:"string",default:""},select:{type:"string",default:"#scene"},target:{type:"string",default:"#scene"}},init(){this.changeRoom=this.changeRoom.bind(this)},async changeRoom(){if(t)return;const a=this.el.sceneEl,{url:i,select:n,target:o}=this.data;try{t=!0,window.history.pushState(null,"",i);const s=await fetch(i);if(!s.ok)throw new Error("Network response was not ok");const r=await s.text(),l=(new DOMParser).parseFromString(r,"text/html").querySelector(n);if(l?document.querySelector(o).outerHTML=l.outerHTML:console.error(`Element ${o} not found in the fetched document.`),a.getAttribute("networked-scene").room===this.data.room)return void(t=!1);e||(e={...a.getAttribute("networked-scene"),connectOnLoad:!1}),e.room=this.data.room,a.removeAttribute("networked-scene"),setTimeout(()=>{a.setAttribute("networked-scene",e),a.emit("connect"),document.body.addEventListener("connected",()=>{t=!1;const e=document.getElementById("rig");e.setAttribute("networked-aframe",{creator:NAF.clientId}),NAF.utils.takeOwnership(e)},{once:!0})},1e3)}catch(e){t=!1,console.error("There has been a problem with the fetch operation:",e)}},play(){this.el.addEventListener(this.data.on,this.changeRoom)},pause(){this.el.removeEventListener(this.data.on,this.changeRoom)}})},762:()=>{AFRAME.registerComponent("collectible-item",{schema:{itemId:{type:"string",default:""},itemName:{type:"string",default:"Item"},itemDescription:{type:"string",default:""},itemImage:{type:"string",default:""},itemCategory:{type:"string",default:"other",oneOf:["costume","artifact","souvenir","other"]},collectDistance:{type:"number",default:3},collected:{type:"boolean",default:!1}},init:function(){this.rig=null,this.playerPosition=new THREE.Vector3,this.itemPosition=new THREE.Vector3,this.isCollecting=!1,this.floatingTime=Math.random()*Math.PI*2,this.floatingSpeed=1.5,this.floatingHeight=.2,this.initialY=this.el.object3D.position.y,console.log("ðŸŽ’ Collectible: Item initialized"),console.log("ðŸŽ’ Collectible: Data from HTML:",this.data),console.log("ðŸŽ’ Collectible: itemId:",this.data.itemId),console.log("ðŸŽ’ Collectible: itemName:",this.data.itemName),console.log("ðŸŽ’ Collectible: itemDescription:",this.data.itemDescription),console.log("ðŸŽ’ Collectible: itemImage:",this.data.itemImage),console.log("ðŸŽ’ Collectible: itemCategory:",this.data.itemCategory),window.gameProgress&&"function"==typeof window.gameProgress.registerCollectible&&window.gameProgress.registerCollectible(this.data.itemId),this.checkIfCollected()},checkIfCollected:async function(e=0){const t=localStorage.getItem("userId");t?setTimeout(async()=>{try{if(window.getUserDataFromFirestore){console.log("ðŸŽ’ Collectible: Checking if item already collected:",this.data.itemId);const e=await window.getUserDataFromFirestore(t);e&&e.collectedItems&&Array.isArray(e.collectedItems)?e.collectedItems.includes(this.data.itemId)?(console.log("ðŸŽ’ Collectible: Item already collected, hiding:",this.data.itemId),this.el.setAttribute("collectible-item","collected",!0),this.el.setAttribute("visible",!1),this.el.parentNode&&this.el.parentNode.removeChild(this.el),window.gameProgress&&"function"==typeof window.gameProgress.recordItemCollected&&window.gameProgress.recordItemCollected(this.data.itemId,{awardPoints:!1})):console.log("ðŸŽ’ Collectible: Item not collected yet:",this.data.itemId):console.log("ðŸŽ’ Collectible: User data not found or invalid")}else e<5?(console.log(`ðŸŽ’ Collectible: getUserDataFromFirestore not available yet, retrying (${e+1}/5)`),setTimeout(()=>this.checkIfCollected(e+1),2e3)):console.warn("ðŸŽ’ Collectible: Max retries reached, giving up on collected check")}catch(t){console.error("ðŸŽ’ Collectible: Error checking if collected:",t),e<5&&setTimeout(()=>this.checkIfCollected(e+1),2e3)}},1e3):console.log("ðŸŽ’ Collectible: No user ID, skipping collected check")},tick:function(e,t){if(this.data.collected||this.isCollecting)return;if(!this.rig&&(this.rig=document.getElementById("rig"),!this.rig))return;this.floatingTime+=t/1e3*this.floatingSpeed;const a=Math.sin(this.floatingTime)*this.floatingHeight;this.el.object3D.position.y=this.initialY+a,this.el.object3D.rotation.y+=t/1e3*.5,this.rig.object3D.getWorldPosition(this.playerPosition),this.el.object3D.getWorldPosition(this.itemPosition),this.playerPosition.distanceTo(this.itemPosition)<this.data.collectDistance&&this.collectItem()},collectItem:function(){if(this.isCollecting||this.data.collected)return;this.isCollecting=!0,console.log("Collecting item:",this.data.itemName);const e={id:this.data.itemId,name:this.data.itemName,description:this.data.itemDescription,icon:this.data.itemImage,quantity:1,category:this.data.itemCategory},t={id:this.data.itemId,title:this.data.itemName,description:this.data.itemDescription,imageUrl:this.data.itemImage,category:this.data.itemCategory};console.log("ðŸŽ’ Collectible: Item data for backpack:",e),console.log("ðŸŽ’ Collectible: Popup data for notification:",t),this.animateCollection(),setTimeout(()=>{if(console.log("ðŸŽ’ Collectible: Checking window functions..."),console.log("ðŸŽ’ Collectible: window.addItemToBackpack exists:",typeof window.addItemToBackpack),console.log("ðŸŽ’ Collectible: window.showSimpleNotification exists:",typeof window.showSimpleNotification),window.addItemToBackpack&&window.showSimpleNotification)if(console.log("ðŸŽ’ Collectible: Adding to backpack and showing notification"),window.addItemToBackpack(e),window.showSimpleNotification(t),window.saveCollectedItemToFirestore){console.log("ðŸŽ’ Collectible: Saving to Firestore:",this.data.itemId);const e=localStorage.getItem("userId");e?window.saveCollectedItemToFirestore(e,this.data.itemId).then(()=>{console.log("ðŸŽ’ Collectible: Successfully saved to Firestore:",this.data.itemId)}).catch(e=>{console.error("ðŸŽ’ Collectible: Error saving to Firestore:",e)}):console.warn("ðŸŽ’ Collectible: No user ID, cannot save to Firestore")}else console.warn("ðŸŽ’ Collectible: saveCollectedItemToFirestore function not available");else console.error("ðŸŽ’ Collectible: Missing window functions!"),console.error("ðŸŽ’ Collectible: addItemToBackpack:",typeof window.addItemToBackpack),console.error("ðŸŽ’ Collectible: showSimpleNotification:",typeof window.showSimpleNotification);this.el.setAttribute("collectible-item","collected",!0),this.el.parentNode.removeChild(this.el),console.log("ðŸŽ’ Collectible: Item collected and added to backpack!"),"costume"===this.data.itemCategory&&(async()=>{try{const e=await window.getCurrentSquadId();e&&(window.updateMissionProgress&&await window.updateMissionProgress(e,"collectible"),window.updateSquadPoints&&await window.updateSquadPoints(e,15,`Collected costume: ${this.data.itemName}`))}catch(e){console.error("[Collectible] Error updating squad points:",e)}})(),window.gameProgress&&"function"==typeof window.gameProgress.recordItemCollected&&window.gameProgress.recordItemCollected(this.data.itemId)},500)},animateCollection:function(){const e=performance.now(),t=this.el.object3D.scale.clone(),a=this.el.object3D.position.y,i=new THREE.Vector3(.1,.1,.1),n=a+2,o=s=>{const r=s-e,l=Math.min(r/500,1),d=1-Math.pow(1-l,3);this.el.object3D.scale.lerpVectors(t,i,d),this.el.object3D.position.y=a+(n-a)*d,l<1&&requestAnimationFrame(o)};requestAnimationFrame(o)},getIconForCategory:function(e){switch(e){case"costume":return"ðŸ‘˜";case"artifact":return"ðŸº";case"souvenir":return"ðŸŽ";default:return"ðŸ“¦"}},remove:function(){this.rig=null}})},988:()=>{const e="nusaDwipaProgress",t={score:0,correctAnswers:0,wrongAnswers:0,answeredQuestionIds:new Set,guardTotals:new Map,guardAnswered:new Map,guardLastQuestionIndex:new Map,completedGuards:new Set,collectibleRegistry:new Set,collectedItems:new Set,timer:{startedAt:null,elapsedMs:0,intervalId:null},lastSyncTimeout:null,completed:!1,restored:!1,cachedTotalQuestions:0,cachedTotalCostumes:0};function a(){let e=0;return t.guardTotals.forEach(t=>{e+=t}),e||t.cachedTotalQuestions||0}function i(){const e=n();window.dispatchEvent(new CustomEvent("gameProgress:update",{detail:e}))}function n(){const e=a(),i=Math.max(t.collectibleRegistry.size,t.cachedTotalCostumes||0);return{score:t.score,correctAnswers:t.correctAnswers,wrongAnswers:t.wrongAnswers,answeredQuestions:t.answeredQuestionIds.size,totalQuestions:e,collectedCostumes:t.collectedItems.size,totalCostumes:i,completedGuards:Array.from(t.completedGuards),isCompleted:t.completed,elapsedMs:t.timer.elapsedMs,formattedTime:p(t.timer.elapsedMs),timerStartedAt:t.timer.startedAt}}function o(){if(!t.timer.startedAt){const e=window.roomSession;e&&e.roomStartedAt?(t.timer.startedAt=e.roomStartedAt,t.timer.elapsedMs=Date.now()-t.timer.startedAt):(t.timer.startedAt=Date.now(),t.timer.elapsedMs=0)}if(t.timer.intervalId)console.log("[GameProgress] âœ… Timer already running, ensuring it continues (settings may be open)");else{let e=Date.now();t.timer.intervalId=window.setInterval(()=>{if(t.timer.startedAt){t.timer.elapsedMs=Date.now()-t.timer.startedAt,i();const a=Date.now();if(a-e>=5e3){const i=Math.floor(t.timer.elapsedMs/1e3),n=window.roomSession;n&&n.roomCode&&"function"==typeof window.updateGameTime&&window.setTimeout(()=>{window.updateGameTime(n.roomCode,i).catch(e=>{console.error("[GameProgress] Failed to sync time to database",e)})},0),e=a}}},1e3),console.log("[GameProgress] âœ… Timer interval started, startedAt:",new Date(t.timer.startedAt),"- Timer will NOT stop when settings opens")}}let s=null;function r(){t.timer.intervalId&&(clearInterval(t.timer.intervalId),t.timer.intervalId=null),t.timer.startedAt&&(t.timer.elapsedMs=Date.now()-t.timer.startedAt)}function l(e){const a=t.guardLastQuestionIndex.get(e);if("number"==typeof a)return Math.min(a,t.guardTotals.get(e)||0);const i=t.guardAnswered.get(e);return i?i.size:0}function d(e){if(!t.guardTotals.has(e))return!1;const a=t.guardAnswered.get(e);return a&&a.size>=(t.guardTotals.get(e)||0)}function u(){if(t.completed)return;const e=a(),o=e>0&&t.answeredQuestionIds.size>=e,s=Math.max(t.collectibleRegistry.size,t.cachedTotalCostumes||0),l=s>0&&t.collectedItems.size>=s;if(console.log("[GameProgress] Completion check:",{totalQuestions:e,answeredQuestions:t.answeredQuestionIds.size,allQuestionsDone:o,totalCostumes:s,collectedItems:t.collectedItems.size,allCostumesCollected:l,completed:o&&l}),o&&l){console.log("[GameProgress] âœ… Game completed! All items collected and all quizzes answered."),t.completed=!0,r();const e=Math.floor(t.timer.elapsedMs/1e3);if("function"==typeof window.roomSession?.markSquadCompleted&&window.roomSession.markSquadCompleted(e),c(!0),i(),function(){const e=n();window.dispatchEvent(new CustomEvent("gameProgress:completed",{detail:e}))}(),(()=>{try{const e=window.location.pathname;if(e.includes("game.html")||e.endsWith("/game"))return!0;const t=e.includes("convert.html")||e.endsWith("/convert")||!0===window.__isConvertPage;return!0===window.__soloMode||t}catch{return!1}})()){console.log("[GameProgress] Solo mode detected, saving to leaderboard and redirecting..."),"function"==typeof window.showSimpleNotification&&window.showSimpleNotification("ðŸŽ‰ Selamat! Semua item terkumpul dan semua quiz terjawab!","success",3e3);const a=(()=>{try{const e=window.location.pathname;return e.includes("/public/")?e.replace("/game.html","/leaderboard.html").replace("/game","/leaderboard.html"):"/leaderboard.html"}catch{return"/leaderboard.html"}})();console.log("[GameProgress] Leaderboard path:",a),async function(e,t){try{const a=localStorage.getItem("userUsername")||localStorage.getItem("username")||"Anonymous";if(console.log("[GameProgress] Preparing to save to leaderboard:",{username:a,score:e,elapsedSeconds:t}),"function"==typeof window.saveToLeaderboard)console.log("[GameProgress] Calling window.saveToLeaderboard..."),await window.saveToLeaderboard(a,e,t),console.log("[GameProgress] âœ… Successfully saved to leaderboard");else{if(console.warn("[GameProgress] âš ï¸ window.saveToLeaderboard function not available"),console.warn("[GameProgress] Available window functions:",Object.keys(window).filter(e=>e.includes("save")||e.includes("leaderboard"))),await new Promise(e=>setTimeout(e,1e3)),"function"!=typeof window.saveToLeaderboard)throw new Error("saveToLeaderboard function not available on window object");console.log("[GameProgress] Retrying after delay..."),await window.saveToLeaderboard(a,e,t),console.log("[GameProgress] âœ… Successfully saved to leaderboard (retry)")}}catch(e){throw console.error("[GameProgress] âŒ Error saving to leaderboard:",e),e}}(t.score,e).then(()=>{console.log("[GameProgress] âœ… Saved to leaderboard, redirecting in 2 seconds..."),setTimeout(()=>{window.location.href=a},2e3)}).catch(e=>{console.error("[GameProgress] âŒ Error saving to leaderboard:",e),console.log("[GameProgress] Redirecting anyway..."),setTimeout(()=>{window.location.href=a},2e3)})}else console.log("[GameProgress] Multiplayer mode - not redirecting (handled by RoomFlow)")}}function c(e=!1){t.lastSyncTimeout&&clearTimeout(t.lastSyncTimeout),t.lastSyncTimeout=window.setTimeout(()=>{g(e)},e?300:1500)}function m(){return{score:t.score,correctAnswers:t.correctAnswers,wrongAnswers:t.wrongAnswers,answeredQuestions:t.answeredQuestionIds.size,totalQuestions:a(),collectedCostumes:t.collectedItems.size,totalCostumes:Math.max(t.collectibleRegistry.size,t.cachedTotalCostumes||0),completedGuards:Array.from(t.completedGuards),durationSeconds:Math.floor(t.timer.elapsedMs/1e3),completed:t.completed,answeredQuestionIds:Array.from(t.answeredQuestionIds)}}function h(){try{const a=function(){const e=m();return{...e,cachedTotalQuestions:t.cachedTotalQuestions||e.totalQuestions||0,cachedTotalCostumes:t.cachedTotalCostumes||e.totalCostumes||0,collectedItemIds:Array.from(t.collectedItems),savedAt:Date.now()}}();localStorage.setItem(e,JSON.stringify(a))}catch(e){console.warn("[GameProgress] Unable to persist progress locally:",e)}}async function g(e=!1){h();const t=window.updateQuizStatsToFirestore,a=localStorage.getItem("userId");if("function"!=typeof t||!a)return;const i={...m(),force:e};try{await t(a,i)}catch(e){console.error("[GameProgress] Failed to sync stats:",e)}}function p(e){const t=Math.floor(e/1e3),a=[Math.floor(t/3600),Math.floor(t%3600/60),t%60].map(e=>e.toString().padStart(2,"0"));return`${a[0]}:${a[1]}:${a[2]}`}function y(e={},a=[]){const n=e||{};r(),t.score=n.score||0,t.correctAnswers=n.correctAnswers||0,t.wrongAnswers=n.wrongAnswers||0,t.completed=!!n.completed,t.answeredQuestionIds=new Set(Array.isArray(n.answeredQuestionIds)?n.answeredQuestionIds:[]),t.completedGuards=new Set(Array.isArray(n.completedGuards)?n.completedGuards:[]),t.collectedItems=new Set(Array.isArray(a)?a:[]),"number"==typeof n.totalQuestions&&(t.cachedTotalQuestions=Math.max(t.cachedTotalQuestions,n.totalQuestions)),"number"==typeof n.cachedTotalQuestions&&(t.cachedTotalQuestions=Math.max(t.cachedTotalQuestions,n.cachedTotalQuestions)),"number"==typeof n.totalCostumes&&(t.cachedTotalCostumes=Math.max(t.cachedTotalCostumes,n.totalCostumes)),"number"==typeof n.cachedTotalCostumes&&(t.cachedTotalCostumes=Math.max(t.cachedTotalCostumes,n.cachedTotalCostumes));const o=window.roomSession;if(o&&o.roomStartedAt)t.timer.startedAt=o.roomStartedAt,t.timer.elapsedMs=Date.now()-t.timer.startedAt,console.log("[GameProgress] Timer restored from room startedAt:",new Date(o.roomStartedAt));else{const e=n.durationSeconds||0;t.timer.elapsedMs=1e3*e,t.timer.startedAt=Date.now()-t.timer.elapsedMs,t.timer.startedAt<0&&(t.timer.startedAt=Date.now())}t.guardTotals.forEach((e,a)=>{t.guardAnswered.set(a,new Set),f(a)}),u(),t.restored=!0,i(),h()}function f(e){const a=t.guardTotals.get(e)||0;t.guardAnswered.has(e)||t.guardAnswered.set(e,new Set);const i=t.guardAnswered.get(e);i.clear(),t.answeredQuestionIds.forEach(t=>{const a=t.indexOf(":");if(-1===a)return;const n=t.slice(0,a),o=t.slice(a+1);n===e&&o&&i.add(o)});const n=i.size;t.guardLastQuestionIndex.set(e,Math.min(n,a)),n>=a&&a>0&&t.completedGuards.add(e)}if(window.gameProgress={registerGuard:function(e,a){if(!e||"number"!=typeof a)return;t.guardTotals.set(e,a),t.guardAnswered.set(e,new Set),t.guardLastQuestionIndex.set(e,0),f(e);let n=0;t.guardTotals.forEach(e=>{n+=e}),n>t.cachedTotalQuestions&&(t.cachedTotalQuestions=n),console.log("[GameProgress] Guard registered:",{guardId:e,totalQuestions:a,totalGuards:t.guardTotals.size,totalQuestions:n}),i(),u()},registerCollectible:function(e){e&&(t.collectibleRegistry.has(e)||(t.collectibleRegistry.add(e),t.collectibleRegistry.size>t.cachedTotalCostumes&&(t.cachedTotalCostumes=t.collectibleRegistry.size),console.log("[GameProgress] Collectible registered:",{itemId:e,totalCollectibles:t.collectibleRegistry.size}),i(),u()))},recordQuestionResult:function({guardId:e,questionId:a,isCorrect:n}){if(!e||!a)return;const o=t.guardAnswered.get(e);if(!o||!o.has(a)){if(o&&o.add(a),t.answeredQuestionIds.add(`${e}:${a}`),n?(t.correctAnswers+=1,t.score+=5):(t.wrongAnswers+=1,t.score+=-3),"function"==typeof window.roomSession?.recordQuiz){const t=n?5:-3;window.roomSession.recordQuiz(e,a,n,t)}o&&t.guardLastQuestionIndex.set(e,o.size),d(e)&&t.completedGuards.add(e),c(),u(),i()}},recordItemCollected:function(e,a={}){if(!e||t.collectedItems.has(e))return;t.collectedItems.add(e);const n=!1!==a.awardPoints;n&&(t.score+=10),"function"==typeof window.roomSession?.recordCollectible&&window.roomSession.recordCollectible(e,n?10:0),c(),u(),i()},ensureTimerRunning:o,startTimerFromRoomStartedAt:function(e){if(e&&"number"==typeof e){if(s!==e||t.timer.startedAt!==e||!t.timer.intervalId){if(s=e,r(),t.timer.startedAt=e,t.timer.elapsedMs=Date.now()-t.timer.startedAt,!t.timer.intervalId){let e=Date.now();t.timer.intervalId=window.setInterval(()=>{if(t.timer.startedAt){t.timer.elapsedMs=Date.now()-t.timer.startedAt,i();const a=Date.now();if(a-e>=5e3){const i=Math.floor(t.timer.elapsedMs/1e3),n=window.roomSession;n&&n.roomCode&&"function"==typeof window.updateGameTime&&window.setTimeout(()=>{window.updateGameTime(n.roomCode,i).catch(e=>{console.error("[GameProgress] Failed to sync time to database",e)})},0),e=a}}},1e3)}i(),console.log("[GameProgress] Timer started from room startedAt:",new Date(e))}}else console.warn("[GameProgress] Invalid roomStartedAt:",e)},startSoloTimer:function(){t.timer.startedAt?(o(),console.log("[GameProgress] Solo timer already started, ensuring it runs (settings may be open)")):(t.timer.startedAt=Date.now(),t.timer.elapsedMs=0,o(),i(),console.log("[GameProgress] Solo timer started at:",new Date(t.timer.startedAt)))},isGuardCompleted:d,getNextQuestionIndex:l,getGuardProgress:function(e){const a=t.guardAnswered.get(e);return{answeredCount:a?a.size:0,totalQuestions:t.guardTotals.get(e)||0,completed:d(e),nextQuestionIndex:l(e)}},getState:n,reset:function(){r(),t.score=0,t.correctAnswers=0,t.wrongAnswers=0,t.answeredQuestionIds.clear(),t.guardTotals.clear(),t.guardAnswered.clear(),t.guardLastQuestionIndex.clear(),t.completedGuards.clear(),t.collectibleRegistry.clear(),t.collectedItems.clear(),t.timer.startedAt=null,t.timer.elapsedMs=0,t.completed=!1,i()},formatElapsed:p,restoreFromFirestore:y},window.pendingGameProgressRestore){const{stats:e,collectedItems:t}=window.pendingGameProgressRestore;y(e,t),delete window.pendingGameProgressRestore}const b=function(){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.warn("[GameProgress] Unable to load local progress snapshot:",e),null}}();b&&!t.restored&&y(b,b.collectedItemIds||[]),window.addEventListener("beforeunload",()=>{h(),t.lastSyncTimeout&&clearTimeout(t.lastSyncTimeout),g(!0)}),i()}},t={};function a(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,a),o.exports}return(()=>{"use strict";a(988),a(134),a(710),a(430),a(585),a(762);const e={honai_papua:{guardName:"Penjaga Papua",houseName:"Rumah Honai Papua",quiz:{intro:"Selamat datang di Rumah Honai Papua! Buktikan pengetahuanmu tentang budaya Pegunungan Tengah.",questions:[{id:"honai_q1",prompt:"Di belakang saya berdiri rumah adat bernamaâ€¦",options:["Rumah Honai","Rumah Joglo","Rumah Gadang"],correctIndex:0,explanation:"Rumah Honai adalah rumah adat khas suku Dani yang berbentuk bundar dan beratap jerami."},{id:"honai_q2",prompt:"Mengapa Rumah Honai dibuat nyaris tanpa jendela?",options:["Untuk menahan hawa dingin pegunungan","Supaya lebih mudah dipindahkan","Agar cahaya matahari langsung masuk"],correctIndex:0,explanation:"Pegunungan Tengah Papua bersuhu dingin, sehingga Honai dibuat rapat untuk menyimpan panas."},{id:"honai_q3",prompt:"Bahan tradisional yang digunakan sebagai penutup atap Rumah Honai adalahâ€¦",options:["Jerami atau ilalang","Genteng tanah liat","Seng bergelombang"],correctIndex:0,explanation:"Jerami atau ilalang mudah ditemukan dan sangat baik menjaga suhu di dalam Honai."}]}},krong_aceh:{guardName:"Penjaga Aceh",houseName:"Rumah Krong Aceh",quiz:{intro:"Assalamualaikum dari Tanah Rencong! Jawab kuis tentang Rumah Krong Bade bersama saya.",questions:[{id:"aceh_q1",prompt:"Tangga Rumah Krong Aceh selalu berjumlah ganjil karenaâ€¦",options:["Melambangkan langkah hidup yang seimbang","Memudahkan air mengalir","Kebetulan tukangnya suka angka ganjil"],correctIndex:0,explanation:"Anak tangga ganjil dipercaya membawa keseimbangan dan keberkahan bagi pemilik rumah."},{id:"aceh_q2",prompt:"Fungsi utama ruang bawah rumah panggung Krong Aceh adalahâ€¦",options:["Tempat menyimpan hasil panen dan aktivitas harian","Arena balap gasing","Tempat menjemur kain songket"],correctIndex:0,explanation:"Ruang bawah digunakan untuk aktivitas sehari-hari dan melindungi rumah dari banjir."},{id:"aceh_q3",prompt:"Rumah Krong Aceh disusun tanpa paku karenaâ€¦",options:["Menggunakan sistem pasak kayu tradisional","Tidak ada besi di Aceh dahulu kala","Supaya mudah dilepas waktu dipindahkan"],correctIndex:0,explanation:"Sistem pasak membuat struktur kuat sekaligus lentur menahan gempa dan angin."}]}},lampung_sumatra:{guardName:"Penjaga Lampung",houseName:"Rumah Nuwo Sesat Lampung",quiz:{intro:"Sai Batin! Mari uji wawasanmu tentang rumah adat Lampung dan budaya Pepadun.",questions:[{id:"lampung_q1",prompt:"Nama lain Rumah Nuwo Sesat yang sering dipakai masyarakat Lampung adalahâ€¦",options:["Balai Adat","Rumah Benteng","Gerga"],correctIndex:0,explanation:"Nuwo Sesat berfungsi sebagai balai adat tempat musyawarah dan upacara besar."},{id:"lampung_q2",prompt:"Warna dominan pada pakaian adat Pepadun yang dipamerkan di dalam adalahâ€¦",options:["Putih dan emas","Merah dan hitam","Hijau dan silver"],correctIndex:0,explanation:"Pakaian Pepadun memadukan putih dan emas sebagai simbol kesucian serta kemuliaan."},{id:"lampung_q3",prompt:"Tiang-tiang tinggi pada Nuwo Sesat berguna untukâ€¦",options:["Melindungi rumah dari banjir dan binatang buas","Menjadikan rumah terasa dingin","Mengaitkan jaring ikan"],correctIndex:0,explanation:"Rumah panggung tinggi menjaga penghuni dari banjir, binatang liar, dan memanfaatkan ruang bawah."}]}},dayak_kalimantan:{guardName:"Penjaga Dayak",houseName:"Rumah Betang Dayak",quiz:{intro:"Selamat datang di hulu sungai! Rumah Betang menyimpan kisah kebersamaan suku Dayak.",questions:[{id:"dayak_q1",prompt:"Rumah Betang Dayak dikenal juga dengan sebutanâ€¦",options:["Rumah Panjang","Rumah Gadang","Rumah Limas"],correctIndex:0,explanation:"Rumah Betang memiliki bentuk memanjang dan bisa dihuni puluhan keluarga."},{id:"dayak_q2",prompt:"Kayu yang sering dipakai untuk membangun Rumah Betang adalahâ€¦",options:["Kayu ulin yang sangat kuat","Kayu mahoni muda","Bambu petung"],correctIndex:0,explanation:"Kayu ulin tahan terhadap rayap dan cuaca, cocok untuk bangunan besar dan tinggi."},{id:"dayak_q3",prompt:"Salah satu nilai utama yang tercermin dari Rumah Betang adalahâ€¦",options:["Semangat hidup bersama dan gotong royong","Keinginan hidup menyendiri","Lomba membangun rumah tercepat"],correctIndex:0,explanation:"Rumah Betang menjadi pusat kehidupan kolektif dan kegiatan adat masyarakat Dayak."}]}},joglo_jawa:{guardName:"Penjaga Jawa",houseName:"Rumah Joglo Jawa",quiz:{intro:"Sugeng rawuh! Mari jawab pertanyaan budaya Jawa sambil dengarkan semilir gamelan.",questions:[{id:"jawa_q1",prompt:"Alat musik tradisional yang terkenal di Jawa dan tampak di dekat sini adalahâ€¦",options:["Gamelan","Sasando","Kolintang"],correctIndex:0,explanation:"Gamelan adalah ansambel musik Jawa dengan gong, kenong, bonang, dan saron."},{id:"jawa_q2",prompt:"Empat tiang utama yang menyangga atap Joglo disebutâ€¦",options:["Saka guru (soko guru)","Cagak duo","Tiang ruyung"],correctIndex:0,explanation:"Soko guru adalah empat tiang pokok yang memegang peranan penting secara struktural dan simbolik."},{id:"jawa_q3",prompt:"Ruang depan Joglo yang biasanya dipakai menyambut tamu disebutâ€¦",options:["Pendhapa","Pawon","Gedong"],correctIndex:0,explanation:"Pendhapa adalah ruang terbuka untuk menerima tamu, pertunjukan seni, atau upacara kecil."}]}},saoraja_sulsel:{guardName:"Penjaga Sulawesi Selatan",houseName:"Rumah Saoraja Sulsel",quiz:{intro:"Assalamu alaikum dari Makassar! Uji pengetahuanmu tentang rumah bangsawan Bugis-Makassar.",questions:[{id:"sulsel_q1",prompt:"Baju adat wanita Bugis yang dipamerkan di dalam rumah ini bernamaâ€¦",options:["Baju Bodo","Baju Kurung Teluk Belanga","Kebaya Encim"],correctIndex:0,explanation:"Baju Bodo berbentuk segi empat berlengan pendek dan dihiasi sarung sutra serta perhiasan emas."},{id:"sulsel_q2",prompt:"Jumlah anak tangga ganjil pada Saoraja melambangkanâ€¦",options:["Tahapan kehidupan yang harus dilalui","Jumlah lumbung padi keluarga","Lantai rahasia untuk menyimpan senjata"],correctIndex:0,explanation:"Tangga ganjil dipercaya membawa keberkahan dan mengingatkan tahapan hidup manusia."},{id:"sulsel_q3",prompt:"Sistem kekerabatan masyarakat Bugis-Makassar yang tercermin dalam Saoraja adalahâ€¦",options:["Matrilineal, garis ibu yang dijunjung tinggi","Patrilineal mutlak","Sistem bilineal"],correctIndex:0,explanation:"Saoraja menjadi simbol keluarga bangsawan dan menunjukkan penghormatan pada garis keturunan ibu."}]}},panjang_kalbar:{guardName:"Penjaga Kalimantan Barat",houseName:"Rumah Panjang Kalimantan Barat",quiz:{intro:"Selamat datang di Kalimantan Barat! Mari kenali Rumah Panjang yang menjadi simbol kebersamaan suku Dayak.",questions:[{id:"panjang_kalbar_q1",prompt:"Rumah Panjang Kalimantan Barat dikenal juga dengan sebutanâ€¦",options:["Rumah Betang","Rumah Gadang","Rumah Joglo"],correctIndex:0,explanation:"Rumah Panjang atau Rumah Betang adalah rumah adat khas Dayak yang berbentuk memanjang dan dihuni banyak keluarga."},{id:"panjang_kalbar_q2",prompt:"Kayu yang sering digunakan untuk membangun Rumah Panjang Kalimantan Barat adalahâ€¦",options:["Kayu ulin yang sangat kuat dan tahan lama","Kayu jati muda","Bambu petung"],correctIndex:0,explanation:"Kayu ulin (kayu besi) adalah kayu khas Kalimantan yang sangat kuat, tahan rayap, dan cocok untuk bangunan besar seperti Rumah Panjang."},{id:"panjang_kalbar_q3",prompt:"Salah satu ciri khas Rumah Panjang Kalimantan Barat adalahâ€¦",options:["Dibangun tinggi di atas tiang untuk melindungi dari banjir dan binatang buas","Memiliki atap berbentuk tanduk kerbau","Menggunakan genteng tanah liat sebagai penutup atap"],correctIndex:0,explanation:"Rumah Panjang dibangun tinggi di atas tiang untuk melindungi penghuni dari banjir sungai dan binatang buas di hutan Kalimantan."}]}},batak_sumut:{guardName:"Penjaga Batak",houseName:"Rumah Adat Batak Toba",quiz:{intro:"Horas! Saatnya buktikan pengetahuanmu tentang rumah bolon dan kain ulos.",questions:[{id:"batak_q1",prompt:"Kain tradisional Batak yang menjadi kebanggaan masyarakat disebutâ€¦",options:["Ulos","Tapis","Songket"],correctIndex:0,explanation:"Ulos adalah kain tenun khas Batak yang sarat makna doa dan hangat secara fisik maupun spiritual."},{id:"batak_q2",prompt:"Bagian tanduk besar pada atap rumah Batak melambangkanâ€¦",options:["Hubungan manusia dengan leluhur dan Tuhan","Tempat menggantung lonceng","Penahan angin"],correctIndex:0,explanation:"Bentuk tanduk mengarah ke langit sebagai pengingat hubungan erat manusia dengan leluhur dan Sang Pencipta."},{id:"batak_q3",prompt:"Rumah bolon dibangun panggung untukâ€¦",options:["Melindungi dari binatang buas dan menyediakan ruang simpan","Memasukkan lebih banyak cahaya","Mempermudah memindahkan rumah"],correctIndex:0,explanation:"Rumah panggung tinggi aman dari binatang dan memanfaatkan ruang bawah untuk ternak atau penyimpanan."}]}},tolitoli_sulteng:{guardName:"Penjaga Tolitoli",houseName:"Rumah Adat Ngata Tolitoli",quiz:{intro:"Salam dari Sulawesi Tengah! Yuk kenali rumah adat dan busana bangsawan Tolitoli.",questions:[{id:"tolitoli_q1",prompt:"Nama pakaian adat yang dipamerkan di sini adalahâ€¦",options:["Pakaian Ngata / Nggoli","Baju Kurung Melayu","Beskap Solo"],correctIndex:0,explanation:"Pakaian Ngata atau Nggoli dipakai bangsawan Tolitoli dengan perpaduan warna cerah dan sulaman emas."},{id:"tolitoli_q2",prompt:"Rumah adat Tolitoli menggunakan warna dasarâ€¦",options:["Kayu alami dengan aksen merah dan emas","Biru laut penuh","Hitam pekat"],correctIndex:0,explanation:"Kayu alami dibiarkan dominan lalu diberi aksen merah dan emas sebagai simbol martabat bangsawan."},{id:"tolitoli_q3",prompt:"Bagian atap rumah Tolitoli cenderungâ€¦",options:["Tinggi dan runcing menyerupai tanduk","Rendah tanpa hiasan","Menggunakan genteng beton"],correctIndex:0,explanation:"Atap tinggi dan runcing menunjukkan status serta memberi sirkulasi udara di iklim pesisir Sulawesi."}]}},bali_artifacts:{guardName:"Penjaga Bali",houseName:"Kompleks Artefak Bali",quiz:{intro:"Om swastyastu! Tiga artefak Bali ini menyimpan filosofi sakral. Siap menjawab pertanyaannya?",questions:[{id:"bali_q1",prompt:"Nama busana kebesaran yang dipamerkan di sini adalahâ€¦",options:["Payas Agung","Payas Solo","Payas Bodo"],correctIndex:0,explanation:"Payas Agung dikenakan dalam upacara sakral Bali dengan dominasi emas dan mahkota tinggi."},{id:"bali_q2",prompt:"Pelinggih Surya biasanya dipakai untukâ€¦",options:["Memuja Dewa Surya saat upacara di sanggah/merajan","Tempat menyimpan hasil panen","Menjemur kain tenun"],correctIndex:0,explanation:"Pelinggih Surya adalah bangunan suci untuk memuja Sang Hyang Surya dalam kompleks pura keluarga."},{id:"bali_q3",prompt:"Motif ukiran pada artefak Bali sarat maknaâ€¦",options:["Keseimbangan alam dan spiritual","Kompetisi antar desa","Petunjuk arah mata angin"],correctIndex:0,explanation:"Setiap motif menggambarkan keharmonisan bhuana agung dan bhuana alit, yaitu alam semesta dan diri manusia."}]}}};AFRAME.registerComponent("satpam-guard",{schema:{houseId:{type:"string"},dialogDistance:{type:"number",default:4}},init:function(){this.guardData=e[this.data.houseId],this.guardData&&this.guardData.quiz||(console.error("ðŸ›ï¸ Satpam Guard: Data tidak ditemukan untuk houseId:",this.data.houseId),this.guardData={guardName:"Satpam",houseName:"Rumah Adat",quiz:{intro:"Informasi belum tersedia.",questions:[]}}),console.log("ðŸ›ï¸ Satpam Guard: Initializing guard for:",this.guardData.houseName),this.rig=null,this.playerPosition=new THREE.Vector3,this.guardPosition=new THREE.Vector3,this.isQuizOpen=!1,this.isNearby=!1,this.poseSet=!1,this.createIndicatorIcon(),this.setupClickHandler(),this.setupModelPose(),window.gameProgress&&"function"==typeof window.gameProgress.registerGuard&&window.gameProgress.registerGuard(this.data.houseId,this.guardData.quiz.questions.length)},update:function(){},createIndicatorIcon:function(){const e=document.createElement("a-entity");e.setAttribute("position","0.7 3.5 0"),e.setAttribute("geometry","primitive: plane; width: 0.4; height: 0.4");const t="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">\n        \x3c!-- Dark grey circular background with 10% opacity --\x3e\n        <circle cx="32" cy="32" r="32" fill="#333333" fill-opacity="0.1"/>\n        \x3c!-- Clean white chat bubble with rounded corners --\x3e\n        <path d="M16 20c0-2.2 1.8-4 4-4h24c2.2 0 4 1.8 4 4v16c0 2.2-1.8 4-4 4H26l-6 6V20z"\n              fill="none"\n              stroke="#ffffff"\n              stroke-width="2.5"\n              stroke-linecap="round"\n              stroke-linejoin="round"\n              style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3))"/>\n        \x3c!-- Three clean white dots ellipsis --\x3e\n        <circle cx="28" cy="32" r="3" fill="#ffffff"/>\n        <circle cx="36" cy="32" r="3" fill="#ffffff"/>\n        <circle cx="44" cy="32" r="3" fill="#ffffff"/>\n      </svg>\n    ');e.setAttribute("material",{src:t,transparent:!0,alphaTest:.5,shader:"flat"}),e.setAttribute("billboard","lockX: true; lockY: true; lockZ: false"),e.setAttribute("animation",{property:"scale",from:"1 1 1",to:"1.2 1.2 1.2",dur:1500,dir:"alternate",easing:"easeInOutSine",loop:!0}),this.el.appendChild(e),this.indicatorIcon=e},setupClickHandler:function(){this.el.addEventListener("click",()=>{this.isNearby&&!this.isQuizOpen&&this.openQuiz()}),this.el.addEventListener("mouseenter",()=>{this.isNearby&&this.el.setAttribute("animation",{property:"scale",to:"1.05 1.05 1.05",dur:200})}),this.el.addEventListener("mouseleave",()=>{this.el.setAttribute("animation",{property:"scale",to:"1 1 1",dur:200})})},setupModelPose:function(){this.el.addEventListener("model-loaded",()=>{console.log("ðŸ›ï¸ Satpam Guard: Model loaded, setting up pose");const e=this.el.components["animation-mixer"];e&&(console.log("ðŸ›ï¸ Satpam Guard: Disabling animation mixer to set pose"),e.mixer&&e.mixer.stopAllAction(),this.el.removeAttribute("animation-mixer"),console.log("ðŸ›ï¸ Satpam Guard: Animation mixer removed")),setTimeout(()=>{this.setReadyPose()},100)}),setTimeout(()=>{this.poseSet||(console.log("ðŸ›ï¸ Satpam Guard: Retrying pose setup after delay"),this.setReadyPose())},1e3),setTimeout(()=>{this.poseSet||(console.log("ðŸ›ï¸ Satpam Guard: Final retry pose setup"),this.setReadyPose())},2e3)},setReadyPose:function(){console.log("ðŸ›ï¸ Satpam Guard: Model ready - using default pose"),this.poseSet=!0},maintainPose:function(){},tick:function(e){if(!this.poseSet&&e>1e3&&this.setReadyPose(),this.isQuizOpen)return;if(!this.rig&&(this.rig=document.getElementById("rig"),!this.rig))return;this.rig.object3D.getWorldPosition(this.playerPosition),this.el.object3D.getWorldPosition(this.guardPosition);const t=this.playerPosition.distanceTo(this.guardPosition),a=this.isNearby;if(this.isNearby=t<this.data.dialogDistance,!a&&this.isNearby&&this.openQuiz(),this.indicatorIcon){const e=window.gameProgress&&"function"==typeof window.gameProgress.isGuardCompleted&&window.gameProgress.isGuardCompleted(this.data.houseId);this.indicatorIcon.setAttribute("visible",!(this.isQuizOpen||e))}},openQuiz:function(){if(!this.isQuizOpen)if(window.gameProgress&&"function"==typeof window.gameProgress.isGuardCompleted&&window.gameProgress.isGuardCompleted(this.data.houseId)){if(window.showSimpleNotification){const e=this.guardData?.houseName||"Rumah Adat",t=this.guardData?.guardName||"Penjaga",a=t.replace(/^Penjaga\s+/i,"").trim(),i=a&&a.length>0?`Penjaga ${a}`:t;window.showSimpleNotification({id:`${this.data.houseId}-completed`,title:i,description:`Anda sudah menjawab quiz penjaga rumah ${e}.`,imageUrl:"",category:"quiz"})}}else if(this.isQuizOpen=!0,console.log("ðŸ›ï¸ Satpam Guard: Opening quiz for",this.guardData.guardName),window.showSatpamDialog){const e=window.gameProgress&&"function"==typeof window.gameProgress.getNextQuestionIndex?window.gameProgress.getNextQuestionIndex(this.data.houseId):0;window.showSatpamDialog({guardId:this.data.houseId,guardName:this.guardData.guardName,houseName:this.guardData.houseName,intro:this.guardData.quiz.intro,questions:this.guardData.quiz.questions,startIndex:e,onClose:()=>{this.closeQuiz()}})}else console.error("ðŸ›ï¸ Satpam Guard: showSatpamDialog function not found!"),this.isQuizOpen=!1},closeQuiz:function(){this.isQuizOpen=!1},remove:function(){this.rig=null,this.indicatorIcon&&this.indicatorIcon.parentNode&&this.indicatorIcon.parentNode.removeChild(this.indicatorIcon)}}),a(33),a(226),a(295),AFRAME.registerComponent("spawn-in-circle",{schema:{radius:{type:"number",default:1}},init:function(){const e=this.el,t=e.getAttribute("position"),a=this.getRandomAngleInRadians(),i=this.randomPointOnCircle(this.data.radius,a),n={x:i.x+t.x,y:t.y,z:i.y+t.z};e.setAttribute("position",n)},getRandomAngleInRadians:function(){return 2*Math.PI*(Math.floor(8*Math.random())/8)},randomPointOnCircle:function(e,t){return{x:Math.cos(t)*e,y:Math.sin(t)*e}}}),AFRAME.registerComponent("jump-ability",{schema:{jumpVelocity:{type:"number",default:5},groundDistance:{type:"number",default:.5},jumpCooldown:{type:"number",default:500}},init:function(){this.onGround=!0,this.lastJumpTime=0,this.isJumping=!1,this.jumpVelocity=0,this.jumpStartY=0,this.gravity=2,this.maxJumpHeight=1.5,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),console.log("Jump ability initialized - Press SPACE to jump")},onKeyDown:function(e){"Space"!==e.code&&32!==e.keyCode&&" "!==e.key||(e.preventDefault(),this.jump())},onKeyUp:function(e){"Space"!==e.code&&32!==e.keyCode&&" "!==e.key||e.preventDefault()},jump:function(){const e=Date.now();if(!(e-this.lastJumpTime<this.data.jumpCooldown)&&this.onGround){const t=this.el.object3D.position;this.jumpStartY=t.y,this.jumpVelocity=2*this.data.jumpVelocity,this.isJumping=!0,this.gravity=2,this.onGround=!1,this.lastJumpTime=e}},tick:function(e,t){if(this.isJumping){const e=this.el.object3D.position.y,a=this.jumpStartY+this.maxJumpHeight;this.jumpVelocity-=this.gravity*t*.01;let i=e+this.jumpVelocity*t*.01;i>a&&(i=a,this.jumpVelocity=0),this.el.object3D.position.y=i;const n=new THREE.Raycaster;n.set(new THREE.Vector3(this.el.object3D.position.x,this.el.object3D.position.y,this.el.object3D.position.z),new THREE.Vector3(0,-1,0)),n.far=5;const o=document.querySelectorAll(".environmentGround, .environmentDressing");let s=1/0,r=!1,l=0;if(o.forEach(e=>{e.object3D&&n.intersectObject(e.object3D,!0).forEach(e=>{e.distance<s&&(s=e.distance,l=this.el.object3D.position.y-e.distance+this.data.groundDistance,r=!0)})}),r&&this.jumpVelocity<=0&&s<=1.2)return this.el.object3D.position.y=l,this.isJumping=!1,this.jumpVelocity=0,void(this.onGround=!0)}else{const e=this.el,t=new THREE.Vector3(e.object3D.position.x,e.object3D.position.y,e.object3D.position.z),a=new THREE.Raycaster,i=new THREE.Vector3(0,-1,0);a.set(t,i),a.far=3*this.data.groundDistance;const n=document.querySelectorAll(".environmentGround, .environmentDressing"),o=[];if(n.forEach(e=>{if(e.object3D){const t=a.intersectObject(e.object3D,!0);o.push(...t)}}),o.sort((e,t)=>e.distance-t.distance),this.onGround=o.length>0&&o[0].distance<1.5*this.data.groundDistance,!this.onGround&&o.length>0){const a=o[0].distance,i=t.y-a+this.data.groundDistance;i-e.object3D.position.y>.5&&(e.object3D.position.y=i,this.onGround=!0)}}},remove:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}});const t={x:0,y:0,z:0};let i=!1;let n=null,o=null;function s(){const e=document.getElementById("scene");e&&(e.querySelectorAll(".environmentGround").forEach(e=>{e.classList.contains("lobby-area")||e.setAttribute("visible",!1)}),e.querySelectorAll('[id^="satpam-"], [collectible-item], .collidable').forEach(e=>{e.classList.contains("lobby-area")||e.classList.contains("lobby-boundary")||e.setAttribute("visible",!1)}),e.querySelectorAll(".lobby-boundary").forEach(e=>{e.setAttribute("visible",!0)}),console.log("[Lobby] Game environment hidden"))}function r(){const e=document.getElementById("scene");e&&(e.querySelectorAll(".environmentGround").forEach(e=>{e.setAttribute("visible",!0)}),e.querySelectorAll('[id^="satpam-"], [collectible-item], .collidable').forEach(e=>{e.classList.contains("lobby-boundary")||e.setAttribute("visible",!0)}),e.querySelectorAll(".lobby-boundary").forEach(e=>{e.setAttribute("visible",!1)}),console.log("[Lobby] Game environment shown"))}window.saveCheckpoint=function(e){t.x=e.x,t.y=e.y,t.z=e.z,i=!0,console.log("âœ… Checkpoint saved at:",t)},window.respawnToCheckpoint=function(){const e=document.getElementById("rig");e&&i&&(e.setAttribute("position",t.x+" "+(t.y+1.6)+" "+t.z),console.log("ðŸ“ Respawned to checkpoint:",t))},window.enterLobbyArea=function(){const e=document.getElementById("rig");if(e){if(!n){const t=e.getAttribute("position")||{x:0,y:0,z:0},a=e.getAttribute("rotation")||{x:0,y:0,z:0};n={...t},o={...a}}s(),e.setAttribute("position","120 1.6 120"),e.setAttribute("rotation","0 180 0"),console.log("[Lobby] Player entered lobby area")}},window.exitLobbyArea=function(){const e=document.getElementById("rig");e&&(r(),e.setAttribute("position","0 1.6 0"),e.setAttribute("rotation","0 0 0"),n=null,o=null,console.log("[Lobby] Player exited lobby, spawned to game map"))},window.hideGameEnvironment=s,window.showGameEnvironment=r})(),{}})());
//# sourceMappingURL=components.js.map